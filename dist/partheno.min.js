!function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(e,i,a,n,r,s,h,l,o,c,u,_,d,f,g,v,m){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uniqueId=e,this.images=[],this.numberOfPairOfTriangles=3,this.patterns=_,this.height=i,this.width=a,this.chamferRt=f,this.chamferRb=g,this.chamferLt=v,this.chamferLb=m,this.enableTriangles=s,this.triangleEvenPattern=h||this._getRandomPattern("triangles"),this.triangleOddPattern=l||this._getRandomPattern("triangles"),this.numberOfPairOfTriangles=r,this.showStrokes=o,this.columnsPerWidth=c,this.canDownload=u,this.chamfer=d,this.backgroundPattern=n,this._init(),this}var e,i,n;return e=t,(i=[{key:"_init",value:function(){this.el_canvas=this._createCanvas("canva-"+this.uniqueId,"zone-"+this.uniqueId),this.el_ctx=this.el_canvas.getContext("2d"),!0===this.canDownload&&this._createDownloadLink(this.uniqueId),console.log("Instance of a Bookmark built."),this._initPatterns("background"),this._initPatterns("triangles")}},{key:"_getRandomPattern",value:function(t){var e=null;if(void 0!==this.patterns[t]){var i=Math.floor(Math.random()*this.patterns[t].length);e=this._getFullPath(this.patterns[t][i].data)}return e}},{key:"_hasChamfer",value:function(){return this.chamferRt||this.chamferRb||this.chamferLt||this.chamferLb}},{key:"_getFullPath",value:function(t){return btoa(this.patterns.path+t)}},{key:"_findPattern",value:function(t){var e;return this.patterns.background.map(function(i){i.title===t&&(e=i.data)}),e}},{key:"_setBackgroundPatterns",value:function(t){if(console.log(this.images),this._hasChamfer())console.log("setBackgroundPatterns with chamfer - "+t),this._chamferedRect(0,0,this.el_canvas.width,this.el_canvas.height,this.chamfer,this.chamferRt,this.chamferRb,this.chamferLt,this.chamferLb),Array.isArray(t)?this._buidMirroredPattern(t):this._applyStyle(this.images[t]),this.el_ctx.fill();else{console.log("setBackgroundPatterns without chamfer - "+t);var e=this._findPattern(t);Array.isArray(e)?(this._buidMirroredPattern(e),this.el_ctx.fill()):(this._applyStyle(this.images[this._getFullPath(e)]),this.el_ctx.fillRect(0,0,this.el_canvas.width,this.el_canvas.height))}}},{key:"_buidMirroredPattern",value:function(t){var e=this;this.el_ctx.strokeRect(0,0,this.el_canvas.width,this.el_canvas.height);var i=parseFloat(this.el_canvas.width/2),a=this.width,n=this.height;t.forEach(function(t,r){var s=e.images[e._getFullPath(t)];s&&(e.el_ctx.drawImage(s,0,0,a,n),r>0&&(1===r&&e.el_ctx.drawImage(s,i,0,a,n),2===r&&e.el_ctx.drawImage(s,0,200,a,n),3===r&&e.el_ctx.drawImage(s,i,200,a,n)))})}},{key:"_roundRect",value:function(t,e,i,a,n,r,s,h,l){var o=t+i,c=e+a;this.el_ctx.beginPath(),this.el_ctx.strokeStyle="green",this.el_ctx.lineWidth="2",r?(s?this.el_ctx.moveTo(t,e):this.el_ctx.moveTo(t+n,e),this.el_ctx.lineTo(o-n,e),this.el_ctx.quadraticCurveTo(o,e,o,e+n)):(l?this.el_ctx.moveTo(t+n,e):this.el_ctx.moveTo(t,e),this.el_ctx.lineTo(o,e)),h?(this.el_ctx.lineTo(o,e+a-n),this.el_ctx.quadraticCurveTo(o,c,o-n,c)):this.el_ctx.lineTo(o,e+a),s?(this.el_ctx.lineTo(t+n,c),this.el_ctx.quadraticCurveTo(t,c,t,c-n)):this.el_ctx.lineTo(t,c),l?(this.el_ctx.lineTo(t,e+n),this.el_ctx.quadraticCurveTo(t,e,t+n,e)):this.el_ctx.lineTo(t,e),this.el_ctx.stroke()}},{key:"_chamferedRect",value:function(t,e,i,a,n,r,s,h,l){var o=t+i,c=e+a;this.el_ctx.moveTo(t+n,e),r?(this.el_ctx.lineTo(o-n,e),this.el_ctx.lineTo(o,e+n)):(this.el_ctx.lineTo(o-n,e),this.el_ctx.lineTo(o,e)),l?(this.el_ctx.lineTo(o,e+a-n),this.el_ctx.lineTo(o-n,c)):this.el_ctx.lineTo(o,e+a),s?(this.el_ctx.lineTo(t+n,c),this.el_ctx.lineTo(t,c-n)):this.el_ctx.lineTo(t,c),h?(this.el_ctx.lineTo(t,e+n),this.el_ctx.lineTo(t+n,e)):this.el_ctx.lineTo(t,e)}},{key:"_createCanvas",value:function(t,e){var i=document.createElement("canvas");i.innerHTML="Votre navigateur ne supporte pas canvas.<br>Essayez avec Firefox, Safari, Chrome ou Opera.";var a=document.getElementById(e);return i.id=t,i.width=this.width,i.height=this.height,i.showStrokes=this.showStrokes,i.chamfer=this.chamfer,i.chamferRt=this.chamferRt,i.chamferRb=this.chamferRb,i.chamferLt=this.chamferLt,i.chamferLb=this.chamferLb,i.backgroundPatternTriangleEven=this.triangleEvenPattern,i.backgroundPatternTriangleOdd=this.triangleOddPattern,a&&a.appendChild(i),this.clearCanvasLayers(),i}},{key:"clearCanvasLayers",value:function(){if(this.el_canvas){var t=this.el_canvas.clientWidth,e=this.el_canvas.clientHeight;this.el_ctx.clearRect(0,0,t,e)}}},{key:"_getFiltered",value:function(t){var e=[];return void 0!==this.patterns[t]&&this.patterns[t].filter(function(t){return t.data&&e.push(t.data),!0}),e}},{key:"getFilteredPatternsObjects",value:function(t){var e={};return this.patterns[t].filter(function(t){return t.data&&(e[t.title]=t.title),!0}),e}},{key:"_initPatterns",value:function(t){var e=this,i=this._getFiltered(t),a=i.length;i.forEach(function(i){if(Array.isArray(i))i.forEach(function(t){var i=new Image,n=e._getFullPath(t);i.onload=function(){e.images[n]=i,e.repeatBackgroundWidth=e.width/i.width,e.repeatBackgroundHeight=e.height/i.height},i.src=atob(n),0===a&&e._triggeredOnPatternsLoaded(atob(n))}),--a,console.log(a+" "+t+" pattern(s) still loading");else{var n=new Image,r=e._getFullPath(i);n.onload=function(){e.images[r]=e.el_ctx.createPattern(n,"repeat"),--a,console.log(a+" "+t+" pattern(s) still loading"),0===a&&e._triggeredOnPatternsLoaded(atob(r))},n.src=atob(r)}})}},{key:"_createDownloadLink",value:function(t){var e=this,i=document.getElementById("zone-"+t),a=document.createElement("a");a.innerHTML="Download the picture",a.className="btn btn-dark",a.href="#",a.role="button",a.addEventListener("click",function(){a.href=e.el_canvas.toDataURL(),a.download="bookmark.jpg"},!1),i&&(i.insertBefore(document.createElement("br"),i.firstChild),i.insertBefore(document.createElement("br"),i.firstChild),i.insertBefore(a,i.firstChild));var n=document.createElement("textarea");n.cols=80,n.rows=10,n.readOnly=!0,n.innerHTML=JSON.stringify(this)}},{key:"_drawBackground",value:function(){this._setBackgroundPatterns(this.backgroundPattern)}},{key:"_applyStyle",value:function(t){console.log("Apply style: "+t),this.el_ctx.fillStyle=t}},{key:"_drawSingleTriangle",value:function(t){var e,i=this;this.patterns.triangles.map(function(a){a.title===(!0===t?i.el_canvas.backgroundPatternTriangleEven:i.el_canvas.backgroundPatternTriangleOdd)&&(e=a.data)}),this._applyStyle(this.images[this._getFullPath(e)]),console.log("Render a "+(t?"even":"odd")+" triangle with "+e),t?(this.el_ctx.lineTo(this._column_width+this._offset,this._first_coef),this.el_ctx.lineTo(this._offset,this._first_coef)):(this.el_ctx.lineTo(this._column_width+this._offset,this._second_coef),this.el_ctx.lineTo(this._offset,this._second_coef))}},{key:"_drawTriangles",value:function(){var t;this._hasChamfer()&&this.el_ctx.clip(),this._column_width=this.el_canvas.width/this.columnsPerWidth;for(var e=this._column_width/2,i=1;i<=this.numberOfPairOfTriangles;i++)for(var a=0;a<this.columnsPerWidth;a++){t=this.el_canvas.height/(2*this.numberOfPairOfTriangles),this.el_ctx.lineWidth=1,this._offset=a*this._column_width,this._first_coef=2*(t*i-t),this._second_coef=this._first_coef+2*t,this._third_coef=(this._second_coef-t)/i*i;for(var n=1;n<=2;n++)this.el_ctx.beginPath(),this.el_ctx.moveTo(e+this._offset,this._third_coef),n%2==1?this._drawSingleTriangle(!0):this._drawSingleTriangle(!1),this.el_ctx.closePath(),this._drawStrokes(),this.el_ctx.fill()}this._hasChamfer()&&this.el_ctx.restore()}},{key:"_drawStrokes",value:function(){!0===this.el_canvas.showStrokes&&(this.el_ctx.strokeStyle="#FF0000",this.el_ctx.stroke())}},{key:"render",value:function(){var t=this;setTimeout(function(){t._drawBackground(),t.enableTriangles&&t._drawTriangles()},100)}},{key:"_triggeredOnPatternsLoaded",value:function(t){this.clearCanvasLayers(),this.render()}}])&&a(e.prototype,i),n&&a(e,n),t}();e.default=n}]);