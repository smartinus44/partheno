!function(t){var e={};function a(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(e,a,i,n,r,s,l,h,c,o,u,f,d,v,g,_,m){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uniqueId=e,this.images=[],this.numberOfPairOfTriangles=3,this.patterns=f,this.height=a,this.width=i,this.chamferRt=v,this.chamferRb=g,this.chamferLt=_,this.chamferLb=m,this.initBackgroundPattern(n),this.enableTriangles=s,this.triangleEvenPattern=l||this.getRandomPattern("triangles"),this.triangleOddPattern=h||this.getRandomPattern("triangles"),this.numberOfPairOfTriangles=r,this.showStrokes=c,this.columnsPerWidth=o,this.canDownload=u,this.chamfer=d,this.el_canvas=this.createCanvas("canva-"+e,"zone-"+e),!0===this.canDownload&&this.createDownloadLink(e),this.el_ctx=this.el_canvas.getContext("2d"),this.initPatterns("background"),this.initPatterns("triangles")}var e,a,n;return e=t,(a=[{key:"initBackgroundPattern",value:function(t){if(t){var e=t;e.map(function(t,a){e[a]=t}),this.backgroundPattern=e}else this.backgroundPattern=this.getRandomPattern("background")}},{key:"getRandomPattern",value:function(t){var e=Math.floor(Math.random()*this.patterns[t].length);return this.getFullPath(this.patterns[t][e].data)}},{key:"setUniqueId",value:function(t){this._uniqueId=t}},{key:"hasChamfer",value:function(){return this.chamferRt||this.chamferRb||this.chamferLt||this.chamferLb}},{key:"getFullPath",value:function(t){return btoa(this.patterns.path+t)}},{key:"setBackgroundPattern",value:function(t){var e=this;this.hasChamfer()?(this.chamferedRect(0,0,this.el_canvas.width,this.el_canvas.height,this.chamfer,this.chamferRt,this.chamferRb,this.chamferLt,this.chamferLb),this.el_ctx.fillStyle=e.images[t],this.el_ctx.fill()):Array.isArray(t)?(e.el_ctx.fillRect(0,0,e.el_canvas.width,e.el_canvas.height),t.forEach(function(t,a){var i=e.images[e.getFullPath(t)],n=parseFloat(e.el_canvas.width/2);if(i){var r=e.width/e.numberOfPairOfTriangles,s=e.height/e.columnsPerWidth;e.el_ctx.drawImage(i,0,0,r,s),a>0&&(1===a&&e.el_ctx.drawImage(i,n,0,r,s),2===a&&e.el_ctx.drawImage(i,0,200,r,s),3===a&&e.el_ctx.drawImage(i,n,200,r,s))}}),this.el_ctx.fill()):(this.el_ctx.fillStyle=e.images[t],this.el_ctx.fillRect(0,0,this.el_canvas.width,this.el_canvas.height))}},{key:"roundRect",value:function(t,e,a,i,n,r,s,l,h){var c=t+a,o=e+i;this.el_ctx.beginPath(),this.el_ctx.strokeStyle="green",this.el_ctx.lineWidth="2",r?(s?this.el_ctx.moveTo(t,e):this.el_ctx.moveTo(t+n,e),this.el_ctx.lineTo(c-n,e),this.el_ctx.quadraticCurveTo(c,e,c,e+n)):(h?this.el_ctx.moveTo(t+n,e):this.el_ctx.moveTo(t,e),this.el_ctx.lineTo(c,e)),l?(this.el_ctx.lineTo(c,e+i-n),this.el_ctx.quadraticCurveTo(c,o,c-n,o)):this.el_ctx.lineTo(c,e+i),s?(this.el_ctx.lineTo(t+n,o),this.el_ctx.quadraticCurveTo(t,o,t,o-n)):this.el_ctx.lineTo(t,o),h?(this.el_ctx.lineTo(t,e+n),this.el_ctx.quadraticCurveTo(t,e,t+n,e)):this.el_ctx.lineTo(t,e),this.el_ctx.stroke()}},{key:"chamferedRect",value:function(t,e,a,i,n,r,s,l,h){var c=t+a,o=e+i;this.el_ctx.moveTo(t+n,e),r?(this.el_ctx.lineTo(c-n,e),this.el_ctx.lineTo(c,e+n)):(this.el_ctx.lineTo(c-n,e),this.el_ctx.lineTo(c,e)),h?(this.el_ctx.lineTo(c,e+i-n),this.el_ctx.lineTo(c-n,o)):this.el_ctx.lineTo(c,e+i),s?(this.el_ctx.lineTo(t+n,o),this.el_ctx.lineTo(t,o-n)):this.el_ctx.lineTo(t,o),l?(this.el_ctx.lineTo(t,e+n),this.el_ctx.lineTo(t+n,e)):this.el_ctx.lineTo(t,e)}},{key:"createCanvas",value:function(t,e){var a=document.createElement("canvas");a.innerHTML="Votre navigateur ne supporte pas canvas.<br>Essayez avec Firefox, Safari, Chrome ou Opera.";var i=document.getElementById(e);return a.id=t,a.width=this.width,a.height=this.height,a.showStrokes=this.showStrokes,a.chamfer=this.chamfer,a.chamferRt=this.chamferRt,a.chamferRb=this.chamferRb,a.chamferLt=this.chamferLt,a.chamferLb=this.chamferLb,a.backgroundPatternTriangleEven=this.triangleEvenPattern,a.backgroundPatternTriangleOdd=this.triangleOddPattern,i.appendChild(a),this.clearCanvasLayers(),a}},{key:"clearCanvasLayers",value:function(){if(this.el_canvas){var t=this.el_canvas.clientWidth,e=this.el_canvas.clientHeight;this.el_ctx.clearRect(0,0,t,e)}}},{key:"getFiltered",value:function(t){var e=[];return this.patterns[t].filter(function(t){return t.data&&e.push(t.data),!0}),e}},{key:"getFilteredPatternsObjects",value:function(t){var e={},a=this;return this.patterns[t].filter(function(t){return t.data&&(Array.isArray(t.data)?e[t.title]=a.getFullPath(t.data[0]):e[t.title]=a.getFullPath(t.data)),!0}),e}},{key:"initPatterns",value:function(t){var e=this.getFiltered(t),a=e.length,i=this;e.forEach(function(e){if(Array.isArray(e))e.forEach(function(t){var e=new Image,a=i.getFullPath(t);e.onload=function(){i.images[a]=e},e.src=atob(a)}),--a,console.log(a+" "+t+" pattern(s) still loading"),0===a&&i._onPatternsLoaded();else{var n=new Image,r=i.getFullPath(e);n.onload=function(){i.images[r]=i.el_ctx.createPattern(n,"repeat"),--a,console.log(a+" "+t+" pattern(s) still loading"),0===a&&i._onPatternsLoaded()},n.src=atob(r)}})}},{key:"createDownloadLink",value:function(t){var e=document.getElementById("zone-"+t),a=document.createElement("a"),i=this;a.innerHTML="Download the picture",a.className="btn btn-dark",a.href="#",a.role="button",a.addEventListener("click",function(){a.href=i.el_canvas.toDataURL(),a.download="bookmark.jpg"},!1),e.insertBefore(document.createElement("br"),e.firstChild),e.insertBefore(document.createElement("br"),e.firstChild);var n=document.createElement("textarea");n.cols=80,n.rows=10,n.readOnly=!0,n.innerHTML=JSON.stringify(i),e.insertBefore(a,e.firstChild)}},{key:"drawBackground",value:function(){this.setBackgroundPattern(this.backgroundPattern)}},{key:"drawTriangles",value:function(){var t;this.el_canvas.chamfer>0&&this.el_ctx.clip();for(var e=this.el_canvas.width/this.columnsPerWidth,a=e/2,i=1;i<=this.numberOfPairOfTriangles;i++)for(var n=0;n<this.columnsPerWidth;n++){t=this.el_canvas.height/(2*this.numberOfPairOfTriangles),this.el_ctx.lineWidth=1;for(var r=n*e,s=2*(t*i-t),l=s+2*t,h=(l-t)/i*i,c=1;c<=2;c++)this.el_ctx.beginPath(),this.el_ctx.moveTo(a+r,h),c%2==1?(this.el_ctx.fillStyle=this.images[this.el_canvas.backgroundPatternTriangleEven],this.el_ctx.lineTo(e+r,s),this.el_ctx.lineTo(r,s)):(this.el_ctx.fillStyle=this.images[this.el_canvas.backgroundPatternTriangleOdd],this.el_ctx.lineTo(e+r,l),this.el_ctx.lineTo(r,l)),this.el_ctx.closePath(),!0===this.el_canvas.showStrokes&&(this.el_ctx.strokeStyle="#FF0000",this.el_ctx.stroke()),this.el_ctx.fill()}this.el_canvas.chamfer>0&&this.el_ctx.restore()}},{key:"render",value:function(){var t=this;setTimeout(function(){console.log("render..."),t.drawBackground(),t.enableTriangles&&t.drawTriangles()},100)}},{key:"_onPatternsLoaded",value:function(){this.clearCanvasLayers(),this.render()}}])&&i(e.prototype,a),n&&i(e,n),t}();e.default=n}]);